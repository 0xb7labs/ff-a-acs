# Arm FF-A v1.1 ACS Test scenarios
-----------------------------------------------------

This document presents the mapping of the rules in the FF-A specification to the
test cases and the steps followed in the tests. This also provides the information
about the test coverage scenarios that are implemented in the current release of
ACS and the scenarios that are planned for the future releases.


| TestName                                                         | Test Assertions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Section                           | Checked by ACS Now | Test Approach or Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ffa_direct_message_error2 | FA_MSG_SEND_DIRECT_REQ:VM and SP access check | 6.4.2 | YES | 1. Send the FFA_MSG_SEND_DIRECT_REQ from S-EP to NS-EP and check for error status code. |
| ffa_spm_id_get | FFA_SPM_ID_GET | 13.9 | YES | 1. Invoke FFA_SPM_ID_GET and check for SPMC id for success status code. |
| ffa_features_intr | FFA_FEATURES: Interrupts query<br>An invocation of the FFA_FEATURES interface with Feature IDs 0x1 and 0x2 or any notification ABI, completes with an invocation of the FFA_ERROR interface with the NOT_SUPPORTED error code, if the callee does not support notifications. | 9.7 | YES | 1. Query FFA_FEATURE with Feature ID 0x1 and check for Notification pending Interrupt id for FFA_SUCCESS status code <br>2. Query FFA_FEATURE with Feature ID 0x2 and check for Scheduler Receiver Interrupt id for FFA_SUCCESS status code. <br> 3. Query FFA_FEATURE with Feature ID 0x3 and check for Managed exit Interrupt id for FFA_SUCCESS status code. |
| notification_bitmap_create | FFA_NOTIFICATION_BITMAP_CREATE | 17.1 | YES | 1. Pass invalid VM ID and check for INVALID_PARAMETERS error code. <br> 2. Try to call twice and check for DENIED error code. |
| notification_bitmap_destroy | FFA_NOTIFICATION_BITMAP_DESTROY | 17.2 | YES | 1. Pass invalid VM ID and check for INVALID_PARAMETERS error code. <br> 2. Try to call twice and check for DENIED error code. <br> 3. invoke without registering the notifications and check for DENIED status code. |
| notification_bind | FFA_NOTIFICATION_BIND | 17.3 | YES | 1. Pass invalid EP ID and check for INVALID_PARAMETERS error code. <br> 2. Pass invalid bitmap or flags and check for INVALID_PARAMETERS error code. |
| notification_unbind | FFA_NOTIFICATION_UNBIND | 17.4 | YES | 1. Pass invalid EP ID and check for INVALID_PARAMETERS error code. <br> 2. Pass invalid bitmap or flags and check for INVALID_PARAMETERS error code. <br> 3. w2/x2 Reserved(MBZ) check. |
| notification_set <br> vm_to_sp_notification <br> vm_to_sp_notification_pcpu | FFA_NOTIFICATION_SET | 17.5 | YES | 1. Pass invalid EP ID and check for INVALID_PARAMETERS error code. <br> 2. Try to set the notification if sender is not permitted to the receiver , check for DENIED status code. <br> 3. Pass invalid flags and check for INVALID_PARAMETERS error code.<br> 4. Invoke the FFA_NOTIFICATION_SET if receiver is not support receipt of notifications and check for DENIED status code. <br> 5. verify FFA_NOTIFICATION_SET for both per-Vcpu and global notifications. |
| notification_get | FFA_NOTIFICATION_GET | 17.6 | YES | 1. Pass invalid EP ID and check for INVALID_PARAMETERS error code. <br> 2. Pass invalid bitmap or flags and check for INVALID_PARAMETERS error code. |
| notification_info_get <br> vm_to_sp_notification| FFA_NOTIFICATION_INFO_GET | 17.7 | YES | 1. Invoke FFA_NOTIFICATION_INFO_GET and get the all pending notifications and target endpoint ids <br> 2. Invoke FFA_NOTIFICATION_INFO_GET for no pending notifications and check for NODATA error status code. |
| vm_to_sp_notification_pcpu <br> vm_to_sp_notification| Signaling from VM0 to SP1 | 9.5 | YES | 1. Bind the notification from SP1 to VM0. <br> 2. Register the SRI and NPI interrupt handlers <br> 3. Trigger the secure interrupt using notification_set from VM0. <br> 4. SPMC inject the SRI to scheduler and handle the SRI interrupt. <br> 5. Get the pending list id count and list ids using the notification info get and schedule target endpoint using the direct request <br> 5. Query FFA_NOTIFICATION_GET for target endpoints and pending notifications and handle the NPI interrupt. |
| vm_to_sp_notification_pcpu <br> vm_to_sp_notification| Notification binding between a VM and SP | 9.4 | YES | 1. Query if SP supports the receipt of notifications using the FFA_PARTITION_GET_INFO <br> 2. Request the SP services using the direct message from VM. <br> 3. Allocate notifications for VM and Bind the notifications to VM usng FFA_NOTIFICATION_BIND <br> 3. Respond to VM with notification details id,service etc. |
| sp_to_sp_waiting| Secure interrupt signaling and queuing for a S-EL1 SP:SP state - Waiting | 8.2 | YES | 1. Register timer interrupt and handler in SP1 endpoint. <br> 2. Program the timer count and invoke the direct response from SP1 <br> 3. excute busy loop from SP2 and wait for interrupt to signal <br> 3. After timer expires secure interrupt triggers and SPMC will preeempt the SP2 and resumes the SP1 endpoint <br> 4. Handle the inteerupt and invoke the ffa_msg_wait <br> 5. SPMC resumes the preempted endpoint(SP2).|
| vm_to_sp_waiting| Secure interrupt triggers in Non-secure state:The execution context is in the waiting state | 8.3.2 | YES | 1. Register timer interrupt and handler in SP1 endpoint. <br> 2. Program the timer count and invoke the direct response from SP1 <br> 3. excute busy loop from VM0 and wait for interrupt to signal <br> 3. After timer expires secure interrupt triggers and SPMC will preeempt the VM0 and resumes the SP1 endpoint <br> 4. Handle the inteerupt and invoke the ffa_msg_wait <br> 5. SPMC resumes the preempted endpoint(VM0).|
| sp_to_sp_blocked | Secure interrupt signaling and queuing for a S-EL1 SP:SP state - Blocked | 8.2 | YES | 1. Register timer interrupt and handler in SP1 endpoint. <br> 2. Program the timer count and invoke the direct request from SP1 to SP2 <br> 3. excute busy loop from SP2 and wait for interrupt to signal <br> 3. After timer expires secure interrupt triggers and SPMC will preeempt the SP2 and resumes the SP1 endpoint <br> 4. Check for FFA_INTERRUPT_32 and handle the interrupt and schedule the preempted SP2 using ffa_run ABI <br> 5. SPMC resumes the preempted endpoint(SP2).|
| vm_to_sp_preempt| Actions for a Non-secure interrupt: Preemption during message processing | 8.4 | YES |1. Allocate RX and TX memory and register using ffa_rxtx_map() from VM and SPs. <br> 2. Fill the payload into parameter registers and send ffa_msg_send_direct_req() from VM to SP0. <br> 3. Process the messgae in SP0 and generate NS physical interrupt. <br> 4. SPMC save the SP0 state and send ffa_interrupt() to VM. <br> 5.Handle the interrupt in VM and VM migrates to another PE. <br> 6. VM resumes SP execution using ffa_run(). <br> 7. SPMC restores SP state and and resumes SP execution. <br> 8. SP completes the message processing and send response back to VM using ffa_msg_send_direct_resp(). |
| vm_to_sp_managed_exit| Actions for a Non-secure interrupt: Managed exit signaled by vIRQ | 8.3.1.2 | YES |1. Allocate RX and TX memory and register using ffa_rxtx_map() from VM and SPs. <br> 2. Fill the payload into parameter registers and send ffa_msg_send_direct_req() from VM to SP0. <br> 3. Process the messgae in SP0 and generate NS physical interrupt. <br> 4. SPMC save the SP0 state and masks NS interrupt. To trigger managed exit SPMC triggers virtual interrupt. <br> 5. SPMC resumes SP0 execution using eret. <br> 6. Handle the virtual interrupt in SP0. <br> 7. Inform VM about managed exit in message using ffa_msg_send_direct_resp() from SP0 to VM. <br> 8. SPMC unmask the NS physical interrupt and send response to VM. <br> 9. Handle the interrupt in VM. <br> 10. VM resume the execution and send ffa_msg_send_direct_req() from VM to SP1 and check for FFA_SUCCESS status code.|
