# Arm FF-A v1.1 S-EL0 ACS Test scenarios
-----------------------------------------------------

This document presents the mapping of the rules in the FF-A specification to the
test cases and the steps followed in the tests. This also provides the information
about the test coverage scenarios that are implemented in the current release of
ACS and the scenarios that are planned for the future releases.


| TestName                                                         | Test Assertions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Checked by ACS Now | Test Approach or Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| static_mapping_dma | Static DMA isolation:A S-EL0 partition uses this model to enable a DMA capable device to use a memory range in the partitios VA space to access a memory range in the partitions PA space | NO | 1. Add static mappings to manifest.<br>2. Try to access the memory region using SMMU upstream device<br>3. Try to share the static memory mapping to another EP and check for error status code.|
| donate_sepid <br>lend_sepid<br>share_sepid | Dynamic DMA isolation:A S-EL0 partition uses this model to enable a DMA capable device to use a memory range in the partitios VA space to access a memory range in the partitions PA space | NO | 1. Allocate memory region and share to SEPID.<br>2. Try to access the memory region using SMMU upstream device.|
| sp_waiting_el0 | Secure interrupt signaling and queuing for a S-EL0 SP:<br>SP state - Waiting | NO | 1. Enable the timer interrupt and handler in the S-EL0 endpoint in the server endpoint.<br>2. Program the timer count and response back to the client using FFA_MSG_SEND_DIRECT_RESP.<br>3. Wait for interrupt from the client side.<br>4. After the timer count expires Interrupt triggers to the S-EL0 endpoint and control goes to the server.<br>5. Handle the interrupt and invoke ffa_msg_wait for interrupt completion. After SPMC resumes the preempted EP.|
| sp_el0_blocked| Secure interrupt signaling and queuing for a S-EL0 SP:<br>SP state - Blocked | YES | 1. Enable the timer interrupt and handler in the S-EL0 endpoint A<br>2. Program the timer count and send a direct request to EP B.<br>3. After the timer count expires SPMC queues Interrupt and make sure the interrupt is not triggered to endpoint B during the blocked state.<br>4. Invoke FFA_MSG_SEND_DIRECT_RESP call from EP A then SPMC pends interrupt to endpoint. Handle the interrupt.<br>5. Schedule the preempted the EP using FFA_RUN|
|sp_preempted_el0  |Secure interrupt signaling and queuing for a S-EL0 SP:<br>SP state - Preempted  | NO | 1. Register timer interrupt and handler in NS EP.<br>2. Schedule the receiver SP and Enable Trusted watchdog and handler in receiver SP<br>3. Program the trusted watchdog timer count and wait for non-secure interrupt.<br>4. handle the non-secure interrupt and wait for secure watchdog timeout.<br>5. After the timer count expires SPMC queues Interrupt and make sure the interrupt is not triggered to the secure endpoint.<br>6. Schedule the secure endpoint and invoke a direct response from the secure EP.<br>7. SPMC pends interrupt to the endpoint once it enters into the waiting state. Handle the interrupt.|
|sp_el0_running |Secure interrupt signaling and queuing for a S-EL0 SP:<br>SP state - Running  | YES |1. Enable the timer interrupt and handler in the S-EL0 endpoint.<br>2. Program the timer count and process the message.<br>3. After the timer count expires SPMC queues Interrupt and make sure the interrupt is not triggered to the endpoint during the running state.<br>4. Invoke direct response and SPMC pends interrupt to the endpoint. Handle the interrupt. |
|ns_intr_queued_el0 |NS-Int - Queued -SEL0 SP  | YES | 1. Register timer interrupt and handler in NS endpoint.<br>2. Program the timer count and send a direct message to S-EL0 EP.<br>3. After the timer count expires SPMC queues Interrupt and make sure interrupt is not triggered to an endpoint during the running state.<br>4. Invoke direct response from S-EL0 and SPMC unmask NS-Int. Schedules the NS world and handles the interrupt.|
|sp_el0_running |Actions for a Secure interrupt:<br>Secure interrupt triggers in Secure state S-EL0 SP<br>The interrupt is a Self S-Int and the target execution context belongs to a S-EL0 SP. The virtual interrupt is queued as it can be signaled only when the execution context enters the waiting state  | YES | 1. Enable the timer interrupt and handler in the S-EL0 endpoint.<br>2. Program the timer count and process the message.<br>3. After the timer count expires SPMC queues Interrupt and make sure the interrupt is not triggered to the endpoint during the running state.<br>4. Invoke direct response and SPMC pends interrupt to the endpoint. Handle the interrupt.|
|ffa_mem_perm_get |FFA_MEM_PERM_GET  | YES | Invoke ffa_mem_perm_get ABI post-initialization on the primary PE or at any time on a secondary PE is completed by the callee, check for DENIED status code.|
| ffa_mem_perm_set |FFA_MEM_PERM_SET | YES | Invoke ffa_mem_perm_set ABI post-initialization on the primary PE or at any time on a secondary PE is completed by the callee, check for DENIED status code.|
